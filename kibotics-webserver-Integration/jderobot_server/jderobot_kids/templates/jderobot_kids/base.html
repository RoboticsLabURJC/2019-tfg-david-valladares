{% load static %} <!-- Cargamos los archivos estaticos -->
{% load i18n %} <!-- Cargamos el módulo de Internacionalización -->

<html lang="es-ES">
  <head>
    <meta http-equiv="Content-type" content="text/html" charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/png" href='{% static "img/kibotics_favicon.png"%}' sizes="16x16">
    <title>Kibotics</title>

    <!-- Bootstrap 3.3.7 from local -->
    <!-- <script src='{% static "js/jquery-3.2.1.min.js"%}'></script> -->
    <!-- <script src='{% static "js/bootstrap.min.js"%}'></script>  -->

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

    <!-- Boostrap from CDN -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <!-- Roboto Typography -->
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>

    <!-- Hoja de Estilo principal de la Aplicación (Main Styles) -->
    <link rel="stylesheet" type="text/css" href='{% static "css/style.css" %}'>
    <link rel="stylesheet" type="text/css" href='{% static "css/navbar.css" %}'>

    <!-- Aniamte CSS -->
    <link rel="stylesheet" type="text/css" href='{% static "css/animate.css" %}'>

    <!--Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>

    {% if user.is_authenticated %}
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
        <script type="text/javascript" src='{% static "js/idle.js" %}'></script>
    {% endif %}
  </head>


  <body>
    <!-- NAVBAR -->
    <nav class="navbar" role="navigation">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        </button>
      </div>
      <div class="navbar-collapse collapse">
        <ul id="logo_container" class="nav navbar-nav">
          <a href="/main_page"><img src='{% static "img/logo_sin_fondo-vertical_azul.png"%}' width="100" height="30" class="d-inline-block align-top" alt=""></a>
          <a id="goToMainPage" href="#" data-toggle="modal" title="Home" data-target="#modal_exit_simulation" style="display: none;"><img src='{% static "img/icons/home.png" %}'/></a>
        </ul>

        <!-- Barra Central del Navbar -->
        <div class="nav navbar-nav" id="navcenter">
          {% if exercise.platform == "real" or exercise.platform == "websim" or exercise.platform == "real-jupyter" and simulation_site and user.is_authenticated %}
            <li><a id="theoryButton" href="#"  title="Teoría" onclick="displayTheory()"><img src='{% static "img/icons/theory.png" %}'/></span></a></li>
            <li><a id="editorButton" href="#" title="Editor" onclick="displayEditor()"><img src='{% static "img/icons/editor.png" %}'/></a></li>
            {%if synchronous %}
              <!--<li><a id="chatButton" href="#" title="Chat" onclick="displayChat()" style="margin-left:75px"><img src='{% static "img/icons/chat.png" %}'/></a></li>-->
              <li><a id="competeButton" href="#" title="Competir" onclick="displayCompete()"><img src='{% static "img/icons/compete.png" %}'/></a></li>
            {% else %}
              <li><a id="simulateButton" href="#" title="Ejecución" onclick="displaySimulator()"><img src='{% static "img/icons/simulator.png" %}'/></span></a></li>
              <li><a id="dualButton" href="#" title="Editor & Ejecución" onclick="displayDual()"><img src='{% static "img/icons/dual.png" %}'/></a></li>
            {% endif %}
            <li><a id="forumButton" href="#" title="Foro"><img src='{% static "img/icons/forum.png" %}'/></a></li>

          {% elif exercise.platform == "theory" and user.is_authenticated %}
            <li><a id="theoryButton" href="#"  title="Teoría" onclick="displayTheory()"><img src='{% static "img/icons/theory.png" %}'/></span></a></li>
            <li><a id="editorButton" href="#" title="Editor" onclick="displayEditor()"><img src='{% static "img/icons/editor.png" %}'/></a></li>
            {%if synchronous %}
              <!--<li><a id="chatButton" href="#" title="Chat" onclick="displayChat()" style="margin-left:75px"><img src='{% static "img/icons/chat.png" %}'/></a></li>-->
              <li><a id="competeButton" href="#" title="Competir" onclick="displayCompete()"><img src='{% static "img/icons/compete.png" %}'/></a></li>
            {% else %}
              <li><a id="simulateButton" href="#" title="Ejecución" onclick="displaySimulator()"><img src='{% static "img/icons/simulator.png" %}'/></span></a></li>
              <li><a id="dualButton" href="#" title="Editor & Ejecución" onclick="displayDual()"><img src='{% static "img/icons/dual.png" %}'/></a></li>
            {% endif %}
            <li><a id="forumButton" href="#" title="Foro"><img src='{% static "img/icons/forum.png" %}'/></a></li>
          {% elif tutorial and user.is_authenticated %}
              <li><a id="theoryButton" href="#"  title="Teoría" onclick="displayTheory()"><img src='{% static "img/icons/theory.png" %}'/></span></a></li>
              <li><a id="editorButton" href="#" title="Editor" onclick="displayEditor()"><img src='{% static "img/icons/editor.png" %}'/></a></li>
              {%if synchronous %}
              <!--<li><a id="chatButton" href="#" title="Chat" onclick="displayChat()" style="margin-left:75px"><img src='{% static "img/icons/chat.png" %}'/></a></li>-->
              <li><a id="competeButton" href="#" title="Competir" onclick="displayCompete()"><img src='{% static "img/icons/compete.png" %}'/></a></li>
            {% else %}
              <li><a id="simulateButton" href="#" title="Ejecución" onclick="displaySimulator()"><img src='{% static "img/icons/simulator.png" %}'/></span></a></li>
              <li><a id="dualButton" href="#" title="Editor & Ejecución" onclick="displayDual()"><img src='{% static "img/icons/dual.png" %}'/></a></li>
            {% endif %}
            <li><a id="forumButton" href="#" title="Foro"><img src='{% static "img/icons/forum.png" %}'/></a></li>
          {% elif exercise.platform == "pyonbrowser-theory" and user.is_authenticated %}
            <li><a id="theoryButton" href="#"  title="Teoría" onclick="displayTheoryTH()"><img src='{% static "img/icons/theory.png" %}'/></span></a></li>
            <li><a id="dualButton" href="#" title="Editor & Ejecución" style="display: none"><img src='{% static "img/icons/dual.png" %}'/></a></li>
            <li><a id="ButtonSwitch" style="display:none;" type="button"  onclick="switchVisible();"><span id="theoryIcon" class="glyphicon glyphicon-console"></span> Ver Teoría</a></li>
          {% elif not user.is_authenticated %}
            <!-- <li><a href="https://foro.kibotics.org">{% trans "Acceso al Foro" %}</a></li> -->
            <a href="/registration/"> {% trans "Registrate" %}</a>
            <a id="goToMainPage" href="/" data-toggle="modal"><span class="glyphicon glyphicon-off"></span> Salir</a>
          {% endif %}
        </div>

        {% if user.is_authenticated %}
          <ul class="nav navbar-nav navbar-right">
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><img src='{% static "img/icons/onoff.png" %}'/></a>
                <ul class="dropdown-menu">
                <li>
                  <div class="info_user navbar-content">
                    <div class="row-navbar">
                      <div class="col-md-12 text-center" style="margin-top:5px">
                        <p data-letters="{{ user|make_list|first|title }}{{ user.last_name|make_list|first|title }}">{{ user }}</p>
                        <div class="divider"></div>
                      </div>
                      <div class="col-md-12 text-center">
                        <span>{{ user.get_full_name }}</span></br>
                        <span id="email" class="text-center small">{{ user.email }}</span>
                        <div class="divider"></div>
                      </div>
                    </div>
                  </div>
                  {% if user.role == "admin" %}
                    <li><a href="/apache_log" target="_blank">Apache log</a></li>
                    <li><a href="/admin"  target="_blank">Administración</a></li>
                    <li><a href="/visits/0/0"  target="_blank">Analíticas</a></li>
                    <div class="divider"></div>
                  {% endif %}
                    <li><a id="version">{{ latest_release_version }}</a></li>

                  <div class="divider"></div>
                  <li><a id="logout_section" href="/logout">{% trans "Cerrar Sesión" %}</a></li>
                </li>
              </ul>
            </li>
          </ul>
        {% endif %}
      </div>
    </nav>


    <!-- EXITED BUTTON -->
    <div class="modal fade text-center" id="modal_exit_simulation" role="dialog">
      <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">×</button>
            <h4 class="modal-title">{% trans "¿Estás seguro de que quieres salir de la simulación?" %}</h4>
          </div>
          <div class="modal-body">
            <div class="row" style="padding-top: 10px">
              <ul>
                <h5 class="text-center">{% trans "Se perderán los cambios que no hayan sido guardados" %}</h5>
              </ul>
            </div>
          </div>
          <div class="modal-footer">
            <a id="savecode" href="#" title="Guardar" onclick="document.getElementById('saveCode').click"><img src='{% static "img/icons/save.png" %}'/></a>
            <a id="modal_exit_simulation" href="/exit_simulation" title="Salir"><img src='{% static "img/icons/exit.png" %}' style="height:30px;"/></a>
          </div>
          <script>
            $(document).ready(function() {
              $('#btn-exit_simulation').click(function() {
                socket.close()
                $('#modal_exit_simulation').modal('toggle');
                $('#loader').removeClass('loaded')
              });
            });
          </script>
        </div>
      </div>
    </div>

    <!-- KILL SIMULATIONS BUTTON -->
    <div class="modal fade text-center" id="modal_kill_simulations" role="dialog">
      <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">{% trans "Terminar todas las simulaciones" %}</h4>
          </div>
          <div class="modal-body">
            <div class="row" style="padding-top: 10px">
              <ul>
                <h5 class="text-center">{% trans "Todas las simulaciones activas terminarán. ¿Estás seguro?" %}</h5>
              </ul>
            </div>
          </div>
          <div class="modal-footer">
            <a type="button" href="/kill_user_simulations" class="btn btn-success">{% trans "Sí, terminar todas las simulaciones" %}</a>
            <a type="button" class="btn btn-danger" data-dismiss="modal">{% trans "No, volver atrás" %}</a>
          </div>
        </div>
      </div>
    </div>


    <!-- Sección para incluir en todas las páginas mensajes de error o de succcess -->
    {% if error %}
      <div class="alert alert-danger col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2" role="alert">
        {{ message | safe}}
        {% if kill_simulations == True %}
          <button id="btn_kill_simulation" type="button" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#modal_kill_simulations"><span class="glyphicon glyphicon-remove"></span> {% trans "Terminar Simulaciones" %}</button>
        {% endif %}
      </div>
    {% elif success %}
      <div class="alert alert-success col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2" role="alert">
        {{ message | safe}}
      </div>
    {% elif inactivity %}
      <div class="alert alert-danger col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2" role="alert">
        {{ message | safe}}
      </div>
    {% elif expired %}
      <div class="alert alert-warning col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2" role="alert">
        <strong>{{ message | safe}}</strong> <a href='#'><button id="renew_subscription" type="button" class="btn btn-warning btn-sm" ><span class="glyphicon glyphicon-euro"></span><span class="glyphicon glyphicon-menu-right"></span> {% trans "Renovar Suscripción" %}</button></a>
      </div>
    {% endif %}


    <!-- Animación de carga de la aplicación -->
    <div id="loader">
      <div id="icon_loader" class="col-xs-offset-4 col-xs-4 col-sm-offset-5 col-sm-2">
          <img id="logo" class="img-responsive animated flipOutY" src="{% static 'img/logo_sin_fondo-vertical_azul.png' %}" alt="" width="100%">
      </div>
      <script>
        function RepeatAnimationLoader(){
          $('#logo').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function(){
            logo = document.getElementById("logo")
            if (logo.className =="img-responsive animated flipOutY") {
              logo.className ="img-responsive animated flipInY"
            } else {
              logo.className ="img-responsive animated flipOutY"
              RepeatAnimationLoader()
            }
          });
        }
        RepeatAnimationLoader()
        $(document).ready(function(){
          document.getElementById("loader").className = "loaded"
          //document.getElementById("loader")
        });
      </script>
    </div>

    {% block content %}

      <!-- CONTENIDO DE LAS DISTINTAS PÁGINAS -->

    {% endblock %}

    {% if not simulation_site %}
        <div class="footer">
          <span>Derechos de autor &copy;<span id="year"></span> - Asociación JdeRobot.</span>   Este sitio utiliza cookies. <a href="/terms#cookies" target="_blank">Más Información</a>
        </div>
    {% endif %}
  </body>
  {% if not simulation_site %}
  <script>
    document.getElementById("year").innerHTML = new Date().getFullYear();
  </script>
  {% endif %}
</html>
