{% extends "jderobot_kids/base.html" %}
{% load static %} <!-- Cargamos los archivos estaticos -->
{% block content %}

  <!-- Physics for A-Frame VR -->
  <link rel="stylesheet" type="text/css" href='{% static "websim/js/css/main.css" %}'>
  <script src='{% static "websim/blockly/js/jquery-3.3.1.min.js"  %}'></script>
  <script src='{% static "websim/js/ace-builds/src-noconflict/ace.js" %}' type="text/javascript" charset="utf-8"></script>
  <script src='{% static "websim/js/build/websim.bundle.js" %}'></script>
  <script src='{% static "websim/js/build/editor.bundle.js" %}'></script>

  <style>
    .navbar {
        margin-bottom: 0px;
      }
  </style>

  <div id="myIFrame" class="col-xs-7 col-md-6" style="padding:0px 0px 0px 0px; height: calc(100vh - 72px)">
    <!--<iframe id="websimframe" allowvr="yes" onload name="websim" src='{% static "websim/js/./simulator.html" style="width: 100%; height:100%;" allow-same-origin allow-scripts></iframe>-->
    <a-scene id="scene" background="color: #9ac1ff;" embedded physics="debug: true" inspector="url: https://aframe.io/releases/0.4.0/aframe-inspector.min.js">
      <a-assets>
        <a-asset-item id="model-pibot" src='{% static "websim/js/assets/models/jrobotF.dae" %}'></a-asset-item>
        <img id="ground" src='{% static "websim/js/assets/textures/cheste-circuit.png" %}'/>
          <a-asset-item id="habitacion" src='{% static "websim/js/assets/models/habitacion.dae" %}'></a-asset-item>
      </a-assets>


        <a-entity position="0 0 0"
                  width="100"
                  height="100"
                  collada-model="#habitacion"
                  scale="3 3 3">
        </a-entity>
        <a-plane static-body position="0 0 0"
                   rotation="-90 0 0"
                   width="50"
                   height="50"
                   repeat="1 1"
                   color="#FFD400">
          </a-plane>
      <!-- Pibot, which body is the asset item with ID = model-pibot -->
      <a-entity dynamic-body="mass: 50;" id="a-pibot" collada-model="#model-pibot" scale="20 20 20" rotation="0 -149.63 0" position="0 0.1 -6.0">
        <a-entity id="secondaryCamera" position="0 0 0" rotation="-20 -90 0">
          <!-- Create a second third-person camera which cant be controlled, the Pibot camera -->
          <a-camera position="0 0.03 -0.01" spectator="canvas:#spectatorDiv;" active="false" wasd-controls-enabled="false" look-controls-enabled="false"></a-camera>
        </a-entity>
      </a-entity>
      <a-entity id="positionSensor"></a-entity>
      <a-box class="collidable" dynamic-body="mass:1000;" scale="1 1 8" position="7.87 0.7 -0.16" rotation="0 0 0" color="#0000ff"></a-box>
      <!--<a-box class="collidable" dynamic-body="mass:1000;" scale="1 1 8" position="2.75 0.7 3.27" rotation="0 89 0" color="#0000ff"></a-box>-->
      <!--<a-box class="collidable" dynamic-body="mass:1000;" scale="1 1 8" position="2.83 0.7 -3.93" rotation="0 89 0" color="#0000ff"></a-box>-->
      <!--<a-box class="collidable" dynamic-body="mass:1000;" scale="1 1 8" position="-2.0 0.7 -0.16" rotation="0 0 0" color="#0000ff"></a-box>-->
      <!-- Scenario -->
      <a-sphere id="mySphere" class="collidable" dynamic-body="mass:10000;" scale="1 1 1" position="2.75 0.01 -2.27" rotation="0 90 0" color="#00ff00"></a-sphere>
      <!--<a-plane static-body position="0 0 0"
                rotation="-90 0 0"
                width="100"
                height="100"
                repeat="1 1"
                src="#ground">
      </a-plane>-->

      <!-- Illumination -->
      <a-light type="ambient" color="white"></a-light>
      <!--<a-light type="point" intensity="1" position="-2 2 4"></a-light>-->

      <a-entity id="primaryCamera" position="0 4 4" rotation="-45 0 0">
        <a-camera></a-camera>
      </a-entity>
    </a-scene>
    <script type="text/javascript" src='{% static "websim/js/js/opencv3.3.1.js" %}' ></script>
  </div>
  <div id="right-container" class="col-xs-5 col-md-6" style="padding:0px 0px 0px 0px; height: calc(100vh - 72px)">
   <div id="buttons" style="background-color:#272822">
        <button onclick id="runbtn"><img src='{% static "websim/blockly/assets/resources/play-icon.png" %}' /></button>
        <button onclick id="cambtn"><img src='{% static "websim/blockly/assets/resources/play-camera-icon.png" %}'/></button>
    </div>
    <div id="ace">
      mainInterval = setInterval(myAlgorithm, 33);

      async function myAlgorithm(){
        myRobot.setV(0.3);
        myRobot.setW(-0.2);
        var img = myRobot.getImage();
        cv.imshow('outputCanvas', img);
      }

    </div>
    <div id="cameras" style="display:inline-flex;">
      <div id="cameraOpenCV" style="margin-left: 5px;">
        <p>OpenCV image</p>
        <canvas id="outputCanvas" ></canvas>
      </div>
      <div id="robotCam">
        <p>Robot Camera</p>
        <div id="spectatorDiv" style="width: 150px; height: 100px;"></div>
      </div>
    </div>
  </div>
{% endblock %}
